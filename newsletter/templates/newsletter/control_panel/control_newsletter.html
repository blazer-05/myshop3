{% extends 'newsletter/control_panel/control_base.html' %}
{% load bootstrap3 %}

{% block content %}

<div class="container">

    <h1 class="page-header">Add Newsletter</h1>

    <form name="select_all" method="post" enctype="multipart/form-data">
        {% csrf_token %}

{#        {% bootstrap_form form %}#}

        <div class="form-group">
            <label for="exampleInputEmail1">Заголовок *</label>
            {{ form.subject }}
        </div>
        <div class="form-group">
            <label for="exampleInputPassword1">Содержимое *</label>
            {{ form.body }}
        </div>

        <div class="form-group">
            <label for="exampleInputEmail1">Email *</label>
            <ul style="list-style: none; margin-left: -40px;">
                {{ form.users_email|unordered_list }}
            </ul>
        </div>

        <input type="button" value="Выделить все" onclick="check(this.form.users_email,1)">
        <input type="button" value="Снять выделение" onclick="check(this.form.users_email,0)">
        <br><br><br>

        <div class="form-group">
            <label for="exampleInputFile">Файл</label>
            {{ form.file }}
            <p class="help-block">Example block-level help text here.</p>
        </div>
        <br>
        <div class="form-group">
            <label for="exampleInputPassword1">Статус *</label>
            {{ form.status }}
        </div>
        <br>

        <button class="btn btn-primary" type="submit">Submit</button>

    </form>
<br>
    <!-- Выделить/Снять выделение чекбоксов -->
    <script type="text/javascript">
        function check(field, flag) {
            if (flag == "1") {
                for (i = 0; i < field.length; i++) {
                    field[i].checked = true;
                }
            } else {
                for (i = 0; i < field.length; i++) {
                    field[i].checked = false;
                }
            }
        }
    </script>

{#    <div class="progress">#}
{#        <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"#}
{#             aria-valuemax="100" style="width: 0%;">#}
{#            0%#}
{#        </div>#}
{#    </div>#}
{##}
{#    <script>#}
{#        $(document).ready(function () {#}
{##}
{#            $('form').on('submit', function (event) {#}
{##}
{#                event.preventDefault();#}
{##}
{#                var formData = new FormData($('form')[0]);#}
{##}
{#                $.ajax({#}
{#                    xhr: function () {#}
{#                        var xhr = new window.XMLHttpRequest();#}
{##}
{#                        xhr.upload.addEventListener('progress', function (e) {#}
{##}
{#                            if (e.lengthComputable) {#}
{##}
{#                                console.log('Bytes Loaded: ' + e.loaded);#}
{#                                console.log('Total Size: ' + e.total);#}
{#                                console.log('Percentage Uploaded: ' + (e.loaded / e.total))#}
{##}
{#                                var percent = Math.round((e.loaded / e.total) * 100);#}
{##}
{#                                $('#progressBar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%');#}
{##}
{#                            }#}
{##}
{#                        });#}
{##}
{#                        return xhr;#}
{#                    },#}
{#                    type: 'POST',#}
{#                    url: '/upload',#}
{#                    data: formData,#}
{#                    processData: false,#}
{#                    contentType: false,#}
{#                    success: function () {#}
{#                        alert('File uploaded!');#}
{#                    }#}
{#                });#}
{##}
{#            });#}
{##}
{#        });#}
{#    </script>#}

    <hr>

    <div class="container pull-left">
        <div class='row'>
            <div class='col-md-12'>
            {% if templates %}
                <div class="panel-group" id="accordion">
                    {% for tpl in templates %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#{{ tpl.id }}">
                                        {{ tpl.name }}
                                    </a>
                                </h4>
                            </div>
                            <div id="{{ tpl.id }}" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <textarea rows="30" cols="135" name="text">{{ tpl.text }}</textarea>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
                {% else %}
                <p>Вы пока не добавили ни одного шаблона!</p>
            {% endif %}
        </div>
    </div>


</div>

{% endblock %}